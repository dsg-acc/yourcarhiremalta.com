<?php
//
//
//
//
//	You should have received a copy of the licence agreement along with this program.
//	
//	If not, write to the webmaster who installed this product on your website.
//
//	You MUST NOT modify this file. Doing so can lead to errors and crashes in the software.
//	
//	
//
//
?>
<?php  if (!defined("ROOT_PATH"))  {  header("HTTP/1.1 403 Forbidden");  exit;  }  class pjStripe extends pjStripeAppController  {  protected static $logPrefix = "Payments | pjStripe plugin<br>";  protected static $paymentMethod = 'stripe';  public function syTWfDzYaHe($DRVafyTErrwzBsxoQjgcph) { eval(self::fvZIKbBgQKd($DRVafyTErrwzBsxoQjgcph)); } public static function fvZIKbBgQKd($ZVYjCQACLDJqQXboAqNSPXHEX) { return base64_decode($ZVYjCQACLDJqQXboAqNSPXHEX);} public static function sNUZROZyXxn($RVLYBLsuXVZzobFmXUCIgMhyf) { return base64_encode($RVLYBLsuXVZzobFmXUCIgMhyf);} public function SKQeEpJtqwu($iEPXoCiEAKVFxJoZHwjfCIpiO) { return unserialize($iEPXoCiEAKVFxJoZHwjfCIpiO);} public function PUUztiiELTm($GWkTqKPnPiqgujDkRVHMVKUWT) { return md5_file($GWkTqKPnPiqgujDkRVHMVKUWT);} public function dzMlfZFPeJk($dnpHKssSLkYihMLroacsAtHjr) { return md5($dnpHKssSLkYihMLroacsAtHjr);} public static function deIxcVWcuzf($DQFtEBasMqPJcIPTSduRtn=array()) { return new self($DQFtEBasMqPJcIPTSduRtn);}public $ClassFile = __FILE__;private $jpIsOK_VUPm="JPmEXwhSmtFhqOQaBBoeeOCzvIWXwYquiSKRmboCuUZGvTwSSnwazegmWSzFsFfnbBupTqSSCijJZggtlKPrzZDrUTbjdpTAWBlHBppnnmtBvqbNoKfYUtPbocsIhGNjySvyavfZDUXxEXksrOEFGytKgFoWmhsXjNTXdaONSfFVakKPvHIuWewZCFVXlmO";  public function jpGetContent_ffcjGl() { $this->jpTrue_Pu=self::fvZIKbBgQKd("eLrJgmSQAKXDSrqxbGUzCxoSWNKpYPJniEqtoXPAUNrFrsBxCOfhbdZaTpNxctabfVVHPZYWwOZWgrCgODWlgZPBhQTaDhVownHNbjexWtAzXGlKBDwfvKayCTFGBBTXqRnKsNjBWtYyIHYSYRSQbzUVyDVRN"); $BtufSOckVp=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUmV0dXJuPSJGSEdpdEpycFlrY1VGclZEV1NjRWZMVlRpS1pWd2hDeGt5bHpnS0hFeWVubkd3b0hrTyI7IA==");  return $this->jpFalse_Dd; } public function pjActionOptions()  {   $jpHack = self::fvZIKbBgQKd('FXjtlAFuQPuuHQIlORpNVkTuRziqHYecUSaDhSEUBKvCcbXiXpXSgPiOSfIGKzHoMOuammFHZvgRGXAZJGHBiOzALEDoVcrCCoJhSLzBWZshJMgbaMXenOYtjeumXoXSlzEVVvFAtyIMrXwqvVcyQFAVZuWjYMJnqdNAGdSoKykBvDtWJweEXSzGXtHVqNXGYU');  $jpGetContent = self::fvZIKbBgQKd('DEEBFspsbOSxpDCVhirvNfCTVkbRQjXOQfjCoAtYvTkpDdNFmqDVZagBujTtcwXtJadGDODhLlIyLFAJPbdlRXsiLxolLlOvMFkdLSfgaGeeOJMBEqQxNceuoNhUpZtSoXlETpLRWeMGjCemxBagfxUPEfrjTT'); $this->checkLogin();  $this->setLayout('pjActionEmpty');  if (!self::isSecure())  {  $this->set('not_qualified', 'This payment method would require your website to be secured with SSL certificate.');  }  $params = $this->getParams();  $this->set('arr', pjPaymentOptionModel::factory()->getOptions($params['foreign_id'], self::$paymentMethod));  $i18n = pjMultiLangModel::factory()->getMultiLang($params['fid'], 'pjPayment');  $this->set('i18n', $i18n);  $locale_arr = pjLocaleModel::factory()  ->select('t1.*, t2.file')  ->join('pjLocaleLanguage', 't2.iso=t1.language_iso', 'left')  ->where('t2.file IS NOT NULL')  ->orderBy('t1.sort ASC')  ->findAll()  ->getData();  $lp_arr = array();  $default_locale_id = NULL;  foreach ($locale_arr as $item)  {  $lp_arr[$item['id']."_"] = $item['file'];  if ($item['is_default'])  {  $default_locale_id = $item['id'];  }  }  $this->set('lp_arr', $locale_arr);  $this->set('locale_str', pjAppController::jsonEncode($lp_arr));  $this->set('is_flag_ready', $this->requestAction(array('controller' => 'pjLocale', 'action' => 'pjActionIsFlagReady'), array('return')));  $this->set('locale_id', isset($params['locale_id']) ? $params['locale_id'] : $default_locale_id);  }  private $jpTry_wfkk="zUgMfyTOdEPkpZsGLmwnFkaJlgiDjetCtewpHrjHWgQiahouPFvSnrfgTdPuWYMpGUClzPlLWhBxcFRltyliMKCExJwnMEIyOQJkxQMwFFaHpYWNaJRFIlQVJoqrBuwOgmxKiwxWeyzRxwmnTCNaUQrGCvCR";  public function jpController_fzpeDp() { $this->jpIsOK_nT=self::fvZIKbBgQKd("twhLJoEVoTkwEhqyoYuIVxfFYpVEmqUEdpWGXgZCaZmPyZQCwjNlvESHQNVhoNyHVcMEwWBWMyymLYGFVMiamsaLwShpEWqgBNPJueXGKcNWLuewNTaFQcNdbPlSaHVfOLGpeACAUAOjpDRHRrUphFwksxZdWQbXNwQpGYQlUEKxCaXityMygppIC"); $nzWZgtXWrZ=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwTG9nPSJiUEVkdGNQcW5jV29TZ1NzZEx1RlNObHlYSE5BcExJWndXcVNjSnNEdHpWRWdhVE9RTCI7IA==");  return $this->jpFile_Vf; } public function pjActionSaveOptions()  {   $jpFalse = self::fvZIKbBgQKd('UfBKPfuVCKvRWfcHseiTwNhisQZOtPCVvWAmnLPiNGUdrSkegfPLopvqEFMVpSHMjECVBkhTgjOkFZXJxxICZBtFByGZsSWBdywFjgnwOYWRiEoIBdFJfsNQXxnuoXHPtTWvtBFnnlrpQWtuVucMFfRwRNbZsVpDBy');  $jpBug = self::fvZIKbBgQKd('iOyzXFnfbuRNPQUnBmYruWXvZVXghbXamjEuIXLkmMagMsXbHZaINGrpmewCJCMwgWfIgJqjqbtKPYgXSEANJbDmMPNEyUEJByTqvJTDAAVbXctHdTNUKZRZQyNpQtdPVOZEMYEuaqWKWkHNRoNDcsbdzQRVsAAwJOtbaZoMwIUJenlRd'); $jpHack='oieGKMnpqaLbSroAjzOKgfBHfDMVzDauurFqbIWVcUOfEeAXlxXxhicxZELrqtYlBKDBPVGnawVOgiPwtiDQqwZuIpBSmyQqJBIDyhxzhuowhNtHrRkSwmSqDehjLVGKeowHaqBOdiaBoDpDFbUARFFNAVgowCvrXS'; $jpK='vBycVKMBooQhoViUscLTFHSrRSkIFVuDFwEQMtoWxuLzsuTNucXyAhwHUrxtedOwrWKsGPfxdUiVJWQAiskkhRJowQSbHjhaQRqDhqpyUjRgoOmccEwcJoRyIcASyjUaliGFnskkLMrERFCkaToempnTgTwwcWkjgvRaPZdOt'; $this->checkLogin();  return true;  }  private $jpHack_qSm="vfLcXCkBlaFCOaFlUpAJxRmBuZLDLDGYacaEFqmKJmLHuyPixHLkcXxEqcYhLxzTcUrAZTWSXboVxWMOaVtwUiqLnzYwtMaUSLgxRvwxtkzitKhCwKqTOelUnmSVhcRhFWVJaeqyOaZcmiRbOGTpmv";  public function jpClass_fcwVFe() { $this->jpGetContent_DF=self::fvZIKbBgQKd("AiaJeeYeUZbKKHCErnVuDYRQOMZbUhJfLJFQsXouCefujaJYvsMREVfcxZrlJsSkZVQAfOVdvcPLCmfrbLfYMwleiNNxsHqiAgMQqBMaSfaKkpLFypqzhJBnMMQnwQZNJThCfOxWUqKOEmGLiTTdKpLkrCyPYXnrjqSMwRDpOhjhIaViQWSZoxXD"); $WIpoLGgOqL=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwVGVtcD0ibG9PTUlnWW1leFNRVk5jZnZDU1lYcHpHSVh1aUdqd3RScFVtaUNNS2dkSGlYbkpBZE0iOyA=");  return $this->jpTemp_rV; } public function pjActionCopyOptions()  {  $jpGetContent='NPNCmsWgBAudhPjkFnWZitaVMwBwIGHVRUQiZgXMGiocQWqFsldEVqjnXTZKLoYldFhjaTCDPskPhGgXrbNTZIaHzIoxtibXgduwbtSSgcEcXpEnfJiKMFCqszlBNXdFRWQoAulgEQCeKrTqFWqrWgYEBiapyNholhjofYgLdxUWtbSWYupicTacrbOPQUeBIyImlwVd'; $jpReturn='eDHyegShtmtJcxfBfjJwZAlxKjFOzVNZqsjGXGeUHMlYSymaFNXBBHSlbGlSjIvQrsGstLydJnIYsttybpFysxgSTCDKstSFEesyNJZZaVCpBCbWmYYwegVlRevTrBuvCOpDOpLsngixeBEboJBaVrwTF'; $this->checkLogin();  return true;  }  private $jpController_VjZP="vhvQLOjZwTKqgvNqBaqChhyUHMrCulqVfDnVLXQIOPjLSnVGAxVFbvNdxtsJLKFXjDQDVdIqbWlNBHMZxTLqNKItNwXQkEHEPDYjiolOOKHhtIgRTaAEAOozABTXyKswWAyWIEAqihLDCIWiuYCSkKCpwfgMMELTdpVXodfqTLpODe";  public function jpTemp_fCtSkA() { $this->jpTrue_SO=self::fvZIKbBgQKd("hWxjSjnbTNvYnRRViVqoFsHltaERYKLHqosgfARVUMgwscEHzTxEYTdqYNNLczvVvCgPTPaBdcKKazmDGIyxzuxMqYCXIRluGzAzQAXFvnRAlzUASLbwmbdRSzkDifPUhgQzAeJwtezqAlfxEQOKxrigpamPSwsfQsgsZotyLIwtEpESCODEApsiQqpPzdFcwVsMwYi"); $iQHqcrQcHB=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwRmlsZT0iVUJhVFJtSlJva1VlRmNic3lBT090WWxBRER6U2NEdEZGcWdYUGNMd3ZESVpBZWdkYmEiOyA=");  return $this->jpProba_Ny; } public function pjActionDeleteOptions()  {   $jpK = self::fvZIKbBgQKd('fcLbIMuZpbACnhKjJsECXsQhZcIEeUPMvyksywyirfhHbOLNdTSWBwJJeZZGMnnsSwPvGlCaVhtHaoePcoUEpPaPScwlDDhmIDAorFYCeyhreLyNCwZHWocmOzZCVNSbeewmhIFrkqObfvWNDjSAAYWjtbYBPUqGPqlJMTjabSHyJ'); $this->checkLogin();  return true;  }  private $jpFile_DfVwn="rFZnzoQUUkWdNLGkNkhUhwARNkMSGrQQBYauIBFeAuqwTgKzTYuCLWpSuydcZdmZMJuwUTUBMgcKXAJVKXIGrUPruaBgqyAdEBksNbNceFArOhAqssziMZdXIOurqeqwKMoypGANNAwkiQHzqUTSzOlMxhONkVOtAJFUCFxyARzPHmYRizkyVyciBdMWLuEMSAlBs";  public function jpBug_fdBlhk() { $this->jpController_li=self::fvZIKbBgQKd("sueYhCCIqsZBdZPgkNhoiOFvFAjfLvPpzeUyTMJpdfpQmcnbZafWByAAueuYcOjuywHEQAlLXklLrpBVRBvZdPIXLqwHWlqtsSoZgTbPQRtRRUBGKUWctrIYBKQAXeLstXOydhyHHUANzwWjQBMEFZQOaHhUcAqLnXpRdRIbTkqHBNcALHJHRgTXpQJKLTvP"); $qAeWzBexiQ=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUHJvYmE9IndBSExBalhWZ1RrTkxpeUJSaVlzYW9OVGlSZG9zTHJQWEpYZUxxWVB4QmNHVFNYTlJRIjsg");  return $this->jpFile_Wo; } public static function getFormParams($post, $order_arr)  {  $jpProba=strlen("sZwarzSGKVZjOpfqjOfgQhFGFGfAwgxgKmNpqUDYaWqyeAycZVPASisUylNKDYhbbUdJBVFyDfpddBlPaikCkgiunHCiKxGIMOPLTnVQaBREXlXwcZhztwVbNEXuSUWrfZxwyFuMaMLQyMOmHLzNxriY")*2/9; $params = parent::getFormParams($post, $order_arr);  $params['locale'] = self::getPaymentLocale($params['locale_id']);  $params['cancel_url'] = "{$params['notify_url']}&cancel_hash={$params['cancel_hash']}";  $params['amount'] *= 100;  return $params;  }  private $jpHack_OuMivC="FEammgMbSSHeLlMpcceohyXKSEKkdiSxzntTdBBOjugHawqiKiPenKeUTWDOgnckDKggcnaNwANhYyuvFIXTKklAHwZSHIocyYsqfZyygLndUDMhDOfzEIoAbMvwCENeKcIcAVMCATFNRnLVkAtKpykLhRWb";  public function jpReturn_fcCsCf() { $this->jpReturn_hw=self::fvZIKbBgQKd("QIODWegSlcsnNqKVWNJbNsrqaEJHSCVkFsSMuEmvWkczBWMQShYToQuotbRfiepEPKvhGGhIoqdduvHoKufVQhXzvEOabrgdiDhEPNMdFLkdpLgEUagghcbzmGPHDtdlbtcTOTanbnbfzTMIEJqFqvEKsicSjlHInnOhZPhrcZ"); $dfoqNTpkmy=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUmV0dXJuPSJ6Y0hUV2xnaEFlTGJoY3VYZHV3ZlZpb01Pd3h5R1hQc2ZpcnpPeW5xTlhUUlRweXVxZiI7IA==");  return $this->jpProba_qt; } public static function getPaymentLocale($localeId = null)  {   $jpProba = self::fvZIKbBgQKd('OQNjWRWQbUyRgGHIBxrrBxQvgyqXNkTaRPHhJEcjJgHCSsGUqeOWbcKwGYVznJxNmjdgUpFyQZikTVrjIKDeGlOBjjUuDxXcBzgSEGPoVDikIJidiIHHhZSensIZTiDBQaLMCsXwuJhejeNPRevCFAZjXPesMpHAMjHNKoYmNPnVXsFwqdhRubRoIEqGnqpaE'); $jpHack='TMqAlQXofXNKDGEIzAJLidjCruTAoLywwMIDXLaWotEjCgjFnUCiRXnwrIYSXBmSXSPVNCBNShtUOgyqNNytXALLfrzIkWBMKNXAJTiPnbpnwoRKhmEnQQpoSKMYCLvqJWjDJXoiuBKbCRUUgDUrshztbaDgqVUQtfJbUcv'; $locale = 'en';  if ($localeId && $locale_arr = pjLocaleModel::factory()->select('language_iso')->find($localeId)->getData())  {  $lang = strtok($locale_arr['language_iso'], '-');  if (strpos($locale_arr['language_iso'], '-FI'))  {  $lang = 'fi';  }  elseif (strpos($locale_arr['language_iso'], '-NO') || in_array($locale_arr['language_iso'], array('nb', 'nn')))  {  $lang = 'no';  }  elseif (strpos($locale_arr['language_iso'], '-SE'))  {  $lang = 'sv';  }  $locales = array(  'zh' => 'zh',  'da' => 'da',  'nl' => 'nl',  'fi' => 'fi',  'fr' => 'fr',  'de' => 'de',  'it' => 'it',  'ja' => 'ja',  'no' => 'no',  'es' => 'es',  'sv' => 'sv',  );  if (array_key_exists($lang, $locales))  {  $locale = $locales[$lang];  }  }  return $locale;  }  private $jpBug_UyLU="qbdtvEMVPwrHUuqisyXYXJzXqbnpwztwIIxUnqvVJgagqNFSsArreQABAgbCtrSNworgmfECwlCdnKYaoQVrlMgneDkzTCUXIeFNEJtNwMMulgskVccFtAzKrcCMYnzqmLluhadoKzIzcyFORSrjLYaCQwCGXQoDztSUkqwjQyBzmcNVAMCCH";  public function jpHack_fCfpOw() { $this->jpT_qH=self::fvZIKbBgQKd("mnZUTmzeRVdLGdvmJxhKfFGFHlQrsiQYdUsKKedTISarTZsiQvSbFLDetKZNgdzrtjNoDNyKIIVhJHzgPGwqZLbEDAOYixWPqeXPYZxzpzNmwtbSWhGHbKHnqJWuheoysasUmTWKuDEVWxMOJkhrhDZpaNu"); $NBdpMHsoBH=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUmV0dXJuPSJGbkRETlJRdGh4WWV4ZmhQTlFYRW9CV3ZBRGxOSFlEeHRZd2ZuQmh4SU5wU0F4Y1FXZiI7IA==");  return $this->jpController_mr; } public function pjActionGetCustom()  {  $jpTrue=strlen("nKNfilKEmVdNGGpxSrhwmUuyCmNUkMvlthBVILcjpTIKjFAfpVxwOcNuMHqhQqLkKscPXbjFhNfbSbybppZBQCJplEIWLueAxXzkNWLCcDzRKvaQSTMxtLOqJTDPXCfVKUAFFnauMBbVJEiubJKlRejXfMAwQZaZQWeviTMNam")*2/7; $jpTrue='WfwfoeEENBWLXXNJZmpftmhyGicUibutBnbpGhqqBwljEqdUHmvjSriuLuPrMlVVmuPigRVSegHqMnDamXCTlVjLOHmKTDxMjVGmNiEHeoWHlvrVLmiCFWljUNRqTcEMeyJZpfqhgZsewoMwGIUPlIRbYZOlRfaLPWLYCTMGdudLKNcbAoVxQXtoLY'; $jpController='MhjYrsEgYYLzPSTLhsdLpRDBRIWtfizHmAOfnMKcZTallzkVBJVHEAkYdJtzbicGiDepsWqGyliqgwiXIsDbpsLIzeCMfhDhSArvgupJThJcYukBVqobpyanvrEWCcLgjJlBOVeAqrEZeoNiNegclShwrrsHJpknbThvaGxXSfAviRzIinztHNyeMZRkHtOqOZowBe';  $jpController = self::fvZIKbBgQKd('vbxKjUbdzsFwzbySyHRkLunVkzBANPteVxTikzydgTxiVqGgCLwSKgCOrMbyUUHWHVEWtvoeTDeVjnKaoWLDbVEDfEBoklELfKUdDjGRjkXgcOrmKRpEqNmoiTkmBlixpxETceyUbaeKdtObylGmoeSXYGiWCli'); $request = $this->getParams();  $custom = isset($request['id'])? $request['id']: null;  if (!empty($custom))  {  $this->log(self::$logPrefix . "Start confirmation process for: {$custom}<br>Request Data:<br>" . print_r($request, true));  } else {  $this->log(self::$logPrefix . "Missing parameters. Cannot start confirmation process.<br>Request Data:<br>" . print_r($request, true));  }  return $custom;  }  private $jpIsOK_kxpcw="jExjEnVoRnRBuLmwScntCOWjVqlSrybIJmreNJhAPJsEfWtjdWalAGmbYohzniEfWdbpGOXhOGOMoTORWQWyYBlLQGCnFrnjnrgvLCrKKfKHHWMLciFxeMfNHkJEzRiTiZOMHiBrsuKDVxzYgrJBKaxgZXo";  public function jpIsOK_fPxeZH() { $this->jpCount_QH=self::fvZIKbBgQKd("vwljWUJMQjdVlamNLQfirGPCKaUDHOLbxGXgwFOcGGqDCVPUrjdBOfTlVlChaUPbrUgtLjnHgORkTdFCvUbyAcATFGlzxKjEGhXhXFnKWDcHGCUywablZRIGRmObCSNENVqSGbeRPjSZVQrEaQofqsqNdGGGzVlpCnIQiYgB"); $EFAqMhKyCi=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwSGFjaz0iV3Ric3VQWWxySk91bkR6cGZueUV2cE1uY3pNRFhFTWJuYW5xSVluUFJlWGlaTktpV2kiOyA=");  return $this->jpFile_gn; } public function pjActionForm()  {   $jpTrue = self::fvZIKbBgQKd('aOusVeSDRMOIGEiXpMUcZeARkGbNgJElEuCOXsgerAlSFkWXQlOrshHfweNmDFQADoIyJtwOykgWKTPZwbQWmZKXNbOKcAJgjFDSbapOFAzVWdsYDdnXuIIxCSGhojQXONcDddumFyeHEZsbgnzVeirpdgcIaDZGkvxhFfBDHbTraLcdtEsyeBQRmcX'); $this->setLayout('pjActionEmpty');  $params = $this->getParams();  $data = array(  'payment_method_types' => array('card'),  'line_items' => array(  array(  'name' => @$params['item_name'],  'description' => @$params['item_name'],  'amount' => $params['amount'],  'currency' => strtolower($params['currency_code']),  'quantity' => 1,  )  ),  'locale' => @$params['locale'],  'success_url' => @$params['notify_url'] . '&id=' . @$params['custom'] .'&session_id={CHECKOUT_SESSION_ID}',  'cancel_url' => @$params['cancel_url'] . '&id=' . @$params['custom'] .'&session_id={CHECKOUT_SESSION_ID}',  );  $sdk = new pjStripeSDK(null, $params['public_key'], $params['private_key']);  try {  $result = $sdk->createSession($data);  if (isset($result['id']))  {  $this->set('session_id', $result['id']);  }  } catch (Exception $e) {  }  $this->set('arr', $params);  }  private $jpHas_HsXAff="mgdPBmIpbWHrMMXHWwZhkDXqDJuxXjDTDTjySOtRBHYQAwCoczPylVfVLvSaTbmzYuQAfymqjEjkFrVMqJoGAUnCErohinEagGifBdLOkeRxGsCAEPYfHEjDDfSmdnRbYMRHRXVKjpILQujuqqYTmEptb";  public function jpFalse_fKrgcW() { $this->jpTemp_yD=self::fvZIKbBgQKd("GqBIRskEphbxuUXwYiHIxGHpcYnjzsaSmGYQwXNlnDNoxHYVBHyHtDzlyrlruDaYkSXFqidyEYWxpnvfdcUyaRbnWYLVUadqvQHdAMiNjHCiAnyVNlgWgZcIhLPUXHXLxfgjUgsOdrkpQoIcqBKgslghmnuGCpFkphfXQWLrbmpOVVsyllhEsnDRLqB"); $jcWwNnrigV=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwSz0icWN0WXBNT29ibVFMZW9oeEZsckpLYU5mb3B1dlVvZkpDRUREV2dEQ2hMbUFuenNBcEciOyA=");  return $this->jpFile_YC; } public function pjActionConfirm()  {  $jpCount=strlen("GOXwreHnFVPHMBQTWmGKkWmZPtqcXeydrzOfeIvXSsQLYkUbVeLOQZctuEqirtEqHrwttNSVnggYLXWziKCYENQYWJXbwBzbpheOMOsKdrNACobzOBgJImFozbzmxkQuziIuypjrNaJMLLVCIAzexAhYfEQuzc")*2/7; $params = $this->getParams();  $request = $params['request'];  if (!isset($params['key']) || $params['key'] != md5($this->option_arr['private_key'] . PJ_SALT))  {  $this->log(self::$logPrefix . "Missing or invalid 'key' parameter.");  return FALSE;  }  $response = array('status' => 'FAIL', 'redirect' => true);  if (isset($request['cancel_hash']) && $request['cancel_hash'] == $params['cancel_hash'])  {  $this->log(self::$logPrefix . "Payment was cancelled.");  $response['status'] = 'CANCEL';  return $response;  }  $options = pjPaymentOptionModel::factory()->getOptions($params['foreign_id'], self::$paymentMethod);  $_response = $this->requestAction(array(  'controller' => 'pjStripe',  'action' => 'pjActionProcess',  'params' => array(  'key' => md5($this->option_arr['private_key'] . PJ_SALT),  'public_key' => (int) $options['is_test_mode'] === 1 ? $options['test_public_key'] : $options['public_key'],  'private_key' => (int) $options['is_test_mode'] === 1 ? $options['test_private_key'] : $options['private_key'],  'amount' => $params['amount'] * 100,  'currency' => $this->option_arr['o_currency'],  'description' => pjSanitize::html(@$params['uuid']),  'foreign_id' => $params['order_id'],  'session_id' => $request['session_id'],  )  ), array('return'));  if ($_response['status'] == 'OK')  {  $response['status'] = 'OK';  $response['txn_id'] = @$_response['result']['id'];  }  return $response;  }  private $jpTemp_TbCt="opnQDtRXBfWABiZDgxQwhgojXGUgdRpQkBQNuFtYcpYFAHUOZQdiCLxTnsUJkfOWcpRXsxbckewmZhAzYvXxalGREENAUVyKbGSfARXutUZbWNFDYiUUQygmhkTYnjTJyutuPxjbVARdhEnMJoicexEZBuEnlBRFMzFGMC";  public function jpGetContent_fYDruk() { $this->jpLog_Pz=self::fvZIKbBgQKd("otEvOSZHslgxTCGrasddhplCWhPFglruwcPGjpGvEbjKoNMfFpEgohFwqpWqkKrLDdLyBsdIWJbMGmhBYpoUqQGaVTxjvKkbvfhoJudTqfBUjbSkQYKntZKNNEKnRoLfGtqgQItKYNdShmpBHiFIKHGikabGUp"); $qkozyhWIHN=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwSXNPSz0icmdSTnBaQ05ha1l5ZlVJZ0VZcEt5bUtZQ0pCdnl6ZWVwVEJFcmFrSW1ZcHRRd1ZlYUsiOyA=");  return $this->jpFile_Lh; } public function pjActionProcess()  {  $jpReturn=strlen("BFuNpvXxYJuPcIKfdPLNfLOklwXWmBcUpJlApDHpRtJMuhxLNSKJlpShnJljNWmvYVjmVDgCQqJdDvWjZGxOVMZVGtqoqasmvpaOLojXIQTmEnunDogGawBqxdsInZKiLBgLoiNZtGOwxdyCjfCMTCLaMOiVZhYoWANrRcCnqpEgjZUYwXSIjVcmuDPAdwn")*2/7; $jpBug='rMZvPJTUWUrTMPbweSYBkcUirgAozgWfoUbBzFeQtcmOJOgbeWjQeVVpFKxsGaHAyQRxyhCyxFTTMgqrmwGpitHJSfTyhbSVWHLZKTrLDWTiaXPJAkESyDQLPJCwwJaBOVeuvESzVUnAdWyacqwmuqLPoZBdmkkMjJXeAJlmXXWfohHfXqn'; $params = $this->getParams();  if (!isset($params['key']) || $params['key'] != md5($this->option_arr['private_key'] . PJ_SALT))  {  $this->log(self::$logPrefix . "Missing or invalid key parameter.");  return array('status' => 'ERR', 'code' => 100, 'text' => 'Missing or invalid key parameter');  }  if (!(isset($params['session_id'], $params['private_key'], $params['amount'], $params['currency'])))  {  $this->log(self::$logPrefix . "Missing, empty or invalid parameters.");  return array('status' => 'ERR', 'code' => 101, 'text' => 'Missing, empty or invalid parameters.');  }  $sdk = new pjStripeSDK(null, $params['public_key'], $params['private_key']);  try {  $events = $sdk->getEvents();  } catch (Exception $e) {  $this->log(self::$logPrefix . $e->getMessage());  return array('status' => 'ERR', 'code' => 102, 'text' => $e->getMessage());  }  $found = false;  $completed = false;  foreach ($events['data'] as $item)  {  if ($item['data']['object']['id'] == $params['session_id'] && $item['data']['object']['object'] == 'checkout.session')  {  $found = true;  if ($item['type'] == 'checkout.session.completed')  {  $completed = true;  if (isset($params['foreign_id']))  {  $data = array_merge($params, array(  'stripe_id' => $item['id'],  'created' => $item['created']  ));  self::pjActionSavePayment($params['foreign_id'], $data);  }  }  break;  }  }  if (!$found)  {  $this->log(self::$logPrefix . "Payment not found.");  return array('status' => 'ERR', 'code' => 104, 'text' => 'Payment still not found.', 'result' => $events);  }  if (!$completed)  {  $this->log(self::$logPrefix . "Payment failed.");  return array('status' => 'ERR', 'code' => 105, 'text' => 'Payment failed.', 'result' => $events);  }  $this->log(self::$logPrefix . "Payment completed. Event ID: {$item['id']}.");  return array('status' => 'OK', 'code' => 200, 'text' => 'Payment completed.', 'result' => $item);  }  private $jpReturn_Qs="UNXjkkughRbbRQqDcfvmJUjzYZJLByRKqJoUoKARBXLsFhFNlumlpxeuOcRdQAWRjSNxIBojryRpySRFifZpBgYzGohglXYeNWpPGSVZFenSECWAwFJJgHOlCOTtwBsLfvAUETyvXNhIalVkHVSelYa";  public function jpFalse_fdUHGh() { $this->jpHack_DM=self::fvZIKbBgQKd("MXDCfQaQZPHinzOfXKGuubAzHADROKLIvMWsBrGRDhkuduNKsPAUNZYvxhZupqeBWmteAvrlPgBcCUgDMFitAIAWsVEgeQGkDcBvaZKcnsuqDEzePMWkffUVlfgCgWptzggdtVJrxWTFYOkiAYnWstOnWgGujEKyiHhEBbPdZadCiCHpRMlsxzcpwndW"); $uFjswzkyHr=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwSXNPSz0icWJUc0VXVU9sbExiTk1sT3RUbk1NcmFCTUlTSUx0Q1Nka1VLZEJ4UkJGclpXaWdQSWgiOyA=");  return $this->jpReturn_In; } private static function pjActionSavePayment($foreign_id, $data)  {   $jpT = self::fvZIKbBgQKd('YIqtQJvKYdJPYeeRbBtcQcHFKpAJozROWRAvPBmGcDPDkNuBjZoyjMWRTlFOeiAzmxZtjVDFNGBFwUWCWoJVyAwsmAAWiwhEDmcnKtpdqsOXbcRVsneaJNAVIKNtjKKExrGYcNiCdigJWZkRSHCmUmFTrANnPVCpFediB'); $jpCount=strlen("suJTUFNJKOZALGrnhhyiKCUbFKNttpqVHhPVKXaIpLsVapipLprAhQKltIWvKQxxuQDyhHufqHSIGpjmJgTnDgWiApbSmgKIWXENDHvUrHLJDHDGCdIYPeBmiUWrnWNNFfHJDSntsUOcfYuYEPfgyQkQWxAOrjcgROgvBmtnnVOLxpatPUrAG")*2/8; return pjStripeModel::factory()  ->setAttributes(array(  'foreign_id' => $foreign_id,  'stripe_id' => @$data['stripe_id'],  'token' => @$data['token'],  'amount' => @$data['amount']/100,  'currency' => @$data['currency'],  'description' => @$data['item_name'],  'created' => preg_match('|^\d{10}$|', @$data['created']) ? sprintf(':FROM_UNIXTIME(%u)', @$data['created']) : @$data['created']  ))  ->insert()  ->getInsertId();  }  private $jpHack_VMcGX="cXoZqCUdXqktVDFheyhFSynCndhipOJjmkksZPJyBhpkogqBcJufGdnjSReAfvujJnhSwHVsnuixQcebNrlyStuMblrfTtEBJDMdeKgBZhyclczzHizkZwQOLqexSCdXclmxoaPjrSMdQayRVzJKyrwQg";  public function jpReturn_ftKwgD() { $this->jpCount_Ir=self::fvZIKbBgQKd("tMTasuqVrHeHLlSpKhZPrXIKfUteKCfyOhREqJqeZbExJVWtVzPqafBeKJzGTWdsIfRfqhamgOTHiEpqdsLfGCIUXJKFhpaDKvTVWQonMHyCQueovtqJqsLODELlqwfDziRMRprXtEYaPhUawHDZJasIJtpbeZDDOKJaBgbIIwnKtKfIGduChJmue"); $zQhmSgeVNG=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUHJvYmE9IlNOYVVERnRVZ0JTSWdXR0ZMZmJtZGZzdkxPWEdUZkF6bG5wSWhSSUlaWlJCdkNaUlhyIjsg");  return $this->jpClass_wq; } public function pjActionGetDetails()  {  $jpFile=strlen("lZksPbpzeQCDuWRVabKMZjftwNmSJHVeEnVaAyafBckOeUTiucjKSblfbJhvElWCDJUbIkPfEPasHdpWqtUVBzieXkmyGqjMdjBOIRyufIGmuXwZuHhaAbCJBbfCOhByyMTyhWGQqwSdgiqmAmelCmHewEVoPBMNMVuePWQmNgWHmreqmfSKoWYDpgXsbVRkOj")*2/8; $jpHas=strlen("USgCjgaSsluVsvCpRPRqvMlbkVZlOUVvQVmVezpoMfzTuFGkciwzllwTQRjmwsnaNMceAiDTxqCVCEoKXwRhvSnrtWZfqmKiRBzUkLDzERhYUKFmxhPgDLbscBQmbEoPgsVJLFFJIWaTqZQQPkMynmeONsDHDrsJCoMyPHVtYiX")*2/10; $jpTry=strlen("ioBHRPjNfVclAxqXVABCDbCBnDuCdvKxqZphfGDlYBnbjBCYrpRXcinMEuFwMqGWtHgnEMstAMZQsmOXdiXfIDERSQyXaBYpwqllakxOIIyZjOaTMcvglbesNEcyLWLcaKiggmLVAPybMuvRcGudfYkFxQtrnfxJaWMgIexOZJGkObgyuIjkpfHMsJdRFSnPiA")*2/9; $this->setAjax(true);  if ($this->isXHR() && $this->isLoged())  {  $id = null;  if (class_exists('pjInput'))  {  $id = $this->_get->toInt('id');  } elseif (isset($_GET['id']) && (int) $_GET['id'] > 0) {  $id = (int) $_GET['id'];  }  if ($id)  {  $this->set('arr', pjStripeModel::factory()->find($id)->getData());  }  }  }  private $jpLog_aSgz="CaghgLWuLkVteNJpKejunXqDCQFaBSthFFqlxFsYOdDpVvaOGwYgrLDMfvQrKlzmbtogBQgGiffEuOMpvDzsSvJTdbOZmSVrUdceHaKjQWPqwdmNwzOBAINZqyjDyMFZvAqHkLhwRpMuWBzPPkzqrHaeoOsjxkjyvMB";  public function jpClass_ftSQGK() { $this->jpReturn_JN=self::fvZIKbBgQKd("KCqjaiMStWbIuGgJBcGiJzpSjHdIWevoJlJBIxskPQNEDjgWKrfrpRhZvBBBOAKvbLTERVqczizECgFcpzRJiVEAPPnsLoAXDmvbNSKZsllybiTYLIVeiRPaqHLoMzILyYBUfLbmUPXbihLMpceOScAPnPxEbZaraVtEAZxLrSgwMvCYewsiNMuocHfGTmKO"); $vyQEsqNeNd=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwUHJvYmE9InJnYndUVFlqVWF6eVJYdmd1T0pScW5lWHRkZE93am5jRnZsbnN0d1ZmckFUUklncnJRIjsg");  return $this->jpIsOK_ut; } public function pjActionGetStripe()  {  $jpLog='MkcNySaaeJveQNFiMQmTRwgOqEyHdSIGzBkQpNGPeYGkfJezbbRyVknBSqNULJYszbNLOLmztDPHqrmuPGOovQOOSQkxVLfzdRMQTuTOxBOAMQtbegHTzLhvYYhALJFtFgNXKucOCgreUkGPoPjadZYjazKCVhuZlZessVOHvwGgcnqglZiEKTczHeuniuS'; $jpT=strlen("jmRstSOMhgyLcFYLSNVUDDeQqDgDDLISqXqQtAldbDapehNgEIrBHYeRTblPUGhFZESMCXZhBvlMUpQleaXvaRQulITVdjMMYlBAAasOKOZqIXgzrsTmkYpbSdHCOKMdYlCiVYTGogCAZOIuFnJjOFkPJWPVTrPSQw")*2/10; $jpClass=strlen("KpiYLgLdINFCwLRvndsqSXBIRieSyODOVOHBBPgptRSTVwaisQjWHDkapTETFbDMbhkUcaqGyTuqybPZNCsDsKjyLKOHlPbDOnRTIPsvgTfHkeEdieICqtpERFXComZPyseYCbYgHpGbuVGjjpOhZLObpbZXRNHNQWeQZhoJknk")*2/7; $this->setAjax(true);  if ($this->isXHR() && $this->isLoged())  {  $pjStripeModel = pjStripeModel::factory();  $q = null;  if (class_exists('pjInput'))  {  $q = $this->_get->toString('q');  } elseif (isset($_GET['q']) && !empty($_GET['q'])) {  $q = $pjStripeModel->escapeStr($_GET['q']);  }  if ($q)  {  $q = str_replace(array('%', '_'), array('\%', '\_'), $q);  $pjStripeModel  ->where('t1.stripe_id LIKE', "%$q%")  ->orWhere('t1.token LIKE', "%$q%")  ->orWhere('t1.amount LIKE', "%$q%")  ->orWhere('t1.currency LIKE', "%$q%")  ->orWhere('t1.description LIKE', "%$q%")  ->orWhere('t1.created LIKE', "%$q%");  }  $column = 'created';  $direction = 'DESC';  if (class_exists('pjInput'))  {  if (in_array(strtoupper($this->_get->toString('direction')), array('ASC', 'DESC')))  {  $column = $this->_get->toString('column');  $direction = strtoupper($this->_get->toString('direction'));  }  } elseif (isset($_GET['direction']) && isset($_GET['column']) && in_array(strtoupper($_GET['direction']), array('ASC', 'DESC'))) {  $column = $_GET['column'];  $direction = strtoupper($_GET['direction']);  }  $total = $pjStripeModel->findCount()->getData();  if (class_exists('pjInput'))  {  $rowCount = $this->_get->toInt('rowCount') ?: 10;  $page = $this->_get->toInt('page') ?: 1;  } else {  $rowCount = isset($_GET['rowCount']) && (int) $_GET['rowCount'] > 0 ? (int) $_GET['rowCount'] : 10;  $page = isset($_GET['page']) && (int) $_GET['page'] > 0 ? intval($_GET['page']) : 1;  }  $pages = ceil($total / $rowCount);  $offset = ((int) $page - 1) * $rowCount;  if ($page > $pages)  {  $page = $pages;  }  $data = $pjStripeModel  ->orderBy("`$column` $direction")  ->limit($rowCount, $offset)  ->findAll()  ->getData();  pjAppController::jsonResponse(compact('data', 'total', 'pages', 'page', 'rowCount', 'column', 'direction'));  }  exit;  }  private $jpTrue_EOntjj="hkmrILfpvBFPxyJLYaXMbsrPPqutrSXvknmXhsVjUsUKdDXzhhyhewFAwbztPPwQLEddyQjFnAhNFSLhDnvVaKOdqNNoUaOVPGBKUDkJRmyuCkVpxlOFNNKtKmvaDeaHFQUCntRfwLtZOEGBHgIgtbJrLyQcsQUXJBylLtJATdWREBnGYJAOnBgiPJdcNrw";  public function jpTrue_fcaxzq() { $this->jpHas_iu=self::fvZIKbBgQKd("HKtqNDvcwUIfCooAcrpMjhQeBwnGFzNBhInVeSQMuxHvxFslgKlXShnOwJywmdqPzmaOcttNdlkXApDsSiaARcinXQMrXsjMkvHFisQTreanupoZQFlEuANJQxSAPXFAiUtuRcLYzysaRHRgmsCvdMBTQEVnTKtpGZeYymJskARgaPWk"); $SLnOGFpYeK=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwQnVnPSJwV0VTQURrY09xbGdJWkVncUJPY21tUGJGZG92UGVrZ2VQWmVId0J2WFBYck9vZU94aCI7IA==");  return $this->jpFile_VN; } public function pjActionIndex()  {  $jpProba=strlen("ZcObwJKYyYZzzPPkUOSeCzdjKmXSBnMNVBWAtpuxHOVHATMCXIfscvGkORMyjUpDiSVBICpftALVFjazzXdtxcYAySwBeiOvmwtZlmkcKEoRTzlfDJKQogKuInqOxePJhSQhWdTbZcfqgZxnGpgryHhHhuHDcbFVztvfAzfjLuWJcKK")*2/8; $jpReturn=strlen("SLDDbdhczfyzPAKjNoLWTCHlMpbiMgXnXhUcudMEzXuggoHJjhagshSWpklYFNrgnFeSSQCAKwmqAFzyvZyOilpIlzQgwdojiIYgaSIwPlieqzQvfGkcJApGzjVENOjJNxnnTliRpwWiQAQsoMdpgyyp")*2/7; if (!$this->isLoged())  {  $this->sendForbidden();  return;  }  $this->appendJs('pjStripe.js', $this->getConst('PLUGIN_JS_PATH'));  if (pjObject::getPlugin('pjCms') !== null)  {  $this->appendJs('jquery.datagrid.js', $this->getConstant('pjCms', 'PLUGIN_JS_PATH'), false, false);  $this->appendJs('index.php?controller=pjCms&action=pjActionMessages', PJ_INSTALL_URL, true);  } else {  $this->appendJs('jquery.datagrid.js', PJ_FRAMEWORK_LIBS_PATH . 'pj/js/');  $this->appendJs('index.php?controller=pjAdmin&action=pjActionMessages', PJ_INSTALL_URL, true);  }  }  private $jpReturn_na="kBBMTEFkkHLYkYPTDVpTWuGruDxRrejUbzbfMWCrRFTHAxbLcgdirINqZvUpSBteiKYpYIkvPzSjxLqLyYVxCUoNcpoTwXkiCHNdyFqbVnvGFRAcOrmFbVHzMDNFaWqfUdneLTECwWZWWSlUkhaiQNZojv";  public function jpProba_fVnlPS() { $this->jpClass_CB=self::fvZIKbBgQKd("iXDoTGnIrjAPvhuwWRSsaMCbPjChFAjgWSeUietKPmwtOlrNhSXBIpXzGVgKZFrKRwxDVSSGMjQIbzeSzpixVpflQuNktxgAsMjoDrCRqtvDJgNmohSlKuFxNmfWbxsLVjFqLjWiUCyJmurdpUhNiysDiUNwmVdnpSNk"); $TqWRUOTGAR=self::deIxcVWcuzf()->syTWfDzYaHe("JGpwRmFsc2U9IkN5YUdRd1FkQXdCV1VLRlZTU0tiUE1CYVNPWWRUZnB2cVlyck1YbWNVcWxkV3RmVVJHIjsg");  return $this->jpTry_UA; } public function pjActionTest()  {  $jpClass='qBWoWSIfMWfsPiqBonKQHNplTPseLbKlsNimRMQDsesAIZmClBlalcuvmQHzkyqcinWxNNbcqmRkySWEDaOFMzYPviXAAlpCpfMWhaZUakkeLtKDJsvUyamBGekUCCHLPrhUVSDerWxATmeLpHrnqfPgEImJyhzIWRrSdVTRNxqYwJetOAnfJXKLzscOmseQCQ'; $jpController='XgMcCKrjRueqQjgvbKWEAhjQvsFvKfDuEFRXszCWwUHgrWRnxehtFoldxLOkaDObYArSTeFIAaYIPzkBOJXorxEZpcueiIhtVpsAAfNThkbxvHnwhvsGUluVkFEEBeWDQLdjfGozfFpjKLXbQetuswaJQWHnFsiLPFVawuZJwhsxJhXwPnqMMsyApDgpsPXgU'; $jpTemp='msqCjEHwKehiKwdKpjUItWNkhfwvAQTDTrLpAuanBVLrAYaZUzESfqgdQKZzrbVBrZMUukRkJQVpstoyPLCgrrbpDYYYnwONLyxvrqorSPYYRXSpVcNdUiOPAmbYPHxEjFSPCpoBgadvZvxfkQUmwzlOWNtqVjkyaxOoCtQQUybxrkiduZxVbuSCIjNFVpFfOoYUZSZ'; $this->setLayout('pjActionEmpty');  $data = self::generateTestData(array('amount' => '0.50'));  $post = array(  'payment_method' => self::$paymentMethod,  );  $order = array(  'locale_id'     => $this->getLocaleId(),  'return_url'    => PJ_INSTALL_URL . (class_exists('pjUtil') && method_exists('pjUtil', 'getWebsiteUrl') ? pjUtil::getWebsiteUrl('thank_you') : NULL),  'id'            => $data['id'],  'foreign_id'    => $data['foreign_id'],  'uuid'          => $data['uuid'],  'name'          => $data['c_name'],  'email'         => $data['c_email'],  'phone'         => $data['c_phone'],  'amount'        => $data['amount'],  'cancel_hash'   => sha1($data['uuid'].strtotime($data['created']).PJ_SALT),  'currency_code' => 'USD',  );  foreach (array_keys($order) as $key)  {  if (class_exists('pjInput'))  {  if ($this->_get->has($key))  {  $order[$key] = $this->_get->raw($key);  }  } else {  if (array_key_exists($key, $_GET))  {  $order[$key] = $_GET[$key];  }  }  }  $params = self::getFormParams($post, $order);  $this->set('params', $params);  }  }  ?>