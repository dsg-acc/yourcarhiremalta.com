(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b=b||self,b.dialogPolyfill=a())}(this,function(){var a=window.CustomEvent;if(!a||typeof a==="object"){a=function l(r,p){p=p||{};var q=document.createEvent("CustomEvent");q.initCustomEvent(r,!!p.bubbles,!!p.cancelable,p.detail||null);return q};a.prototype=window.Event.prototype}function i(q){while(q&&q!==document.body){var p=window.getComputedStyle(q);var r=function(s,t){return !(p[s]===undefined||p[s]===t)};if(p.opacity<1||r("zIndex","auto")||r("transform","none")||r("mixBlendMode","normal")||r("filter","none")||r("perspective","none")||p.isolation==="isolate"||p.position==="fixed"||p.webkitOverflowScrolling==="touch"){return true}q=q.parentElement}return false}function c(p){while(p){if(p.localName==="dialog"){return(p)}p=p.parentElement}return null}function o(p){if(p&&p.blur&&p!==document.body){p.blur()}}function k(p,r){for(var q=0;q<p.length;++q){if(p[q]===r){return true}}return false}function j(p){if(!p||!p.hasAttribute("method")){return false}return p.getAttribute("method").toLowerCase()==="dialog"}function n(q){this.dialog_=q;this.replacedStyleTop_=false;this.openAsModal_=false;if(!q.hasAttribute("role")){q.setAttribute("role","dialog")}q.show=this.show.bind(this);q.showModal=this.showModal.bind(this);q.close=this.close.bind(this);if(!("returnValue" in q)){q.returnValue=""}if("MutationObserver" in window){var t=new MutationObserver(this.maybeHideModal.bind(this));t.observe(q,{attributes:true,attributeFilter:["open"]})}else{var u=false;var p=function(){u?this.downgradeModal():this.maybeHideModal();u=false}.bind(this);var s;var r=function(w){if(w.target!==q){return}var v="DOMNodeRemoved";u|=(w.type.substr(0,v.length)===v);window.clearTimeout(s);s=window.setTimeout(p,0)};["DOMAttrModified","DOMNodeRemoved","DOMNodeRemovedFromDocument"].forEach(function(v){q.addEventListener(v,r)})}Object.defineProperty(q,"open",{set:this.setOpen.bind(this),get:q.hasAttribute.bind(q,"open")});this.backdrop_=document.createElement("div");this.backdrop_.className="backdrop";this.backdrop_.addEventListener("click",this.backdropClick_.bind(this))}n.prototype={get dialog(){return this.dialog_},maybeHideModal:function(){if(this.dialog_.hasAttribute("open")&&document.body.contains(this.dialog_)){return}this.downgradeModal()},downgradeModal:function(){if(!this.openAsModal_){return}this.openAsModal_=false;this.dialog_.style.zIndex="";if(this.replacedStyleTop_){this.dialog_.style.top="";this.replacedStyleTop_=false}this.backdrop_.parentNode&&this.backdrop_.parentNode.removeChild(this.backdrop_);m.dm.removeDialog(this)},setOpen:function(p){if(p){this.dialog_.hasAttribute("open")||this.dialog_.setAttribute("open","")}else{this.dialog_.removeAttribute("open");this.maybeHideModal()}},backdropClick_:function(q){if(!this.dialog_.hasAttribute("tabindex")){var p=document.createElement("div");this.dialog_.insertBefore(p,this.dialog_.firstChild);p.tabIndex=-1;p.focus();this.dialog_.removeChild(p)}else{this.dialog_.focus()}var r=document.createEvent("MouseEvents");r.initMouseEvent(q.type,q.bubbles,q.cancelable,window,q.detail,q.screenX,q.screenY,q.clientX,q.clientY,q.ctrlKey,q.altKey,q.shiftKey,q.metaKey,q.button,q.relatedTarget);this.dialog_.dispatchEvent(r);q.stopPropagation()},focus_:function(){var r=this.dialog_.querySelector("[autofocus]:not([disabled])");if(!r&&this.dialog_.tabIndex>=0){r=this.dialog_}if(!r){var p=["button","input","keygen","select","textarea"];var q=p.map(function(s){return s+":not([disabled])"});q.push('[tabindex]:not([disabled]):not([tabindex=""])');r=this.dialog_.querySelector(q.join(", "))}o(document.activeElement);r&&r.focus()},updateZIndex:function(q,p){if(q<p){throw new Error("dialogZ should never be < backdropZ")}this.dialog_.style.zIndex=q;this.backdrop_.style.zIndex=p},show:function(){if(!this.dialog_.open){this.setOpen(true);this.focus_()}},showModal:function(){if(this.dialog_.hasAttribute("open")){throw new Error("Failed to execute 'showModal' on dialog: The element is already open, and therefore cannot be opened modally.")}if(!document.body.contains(this.dialog_)){throw new Error("Failed to execute 'showModal' on dialog: The element is not in a Document.")}if(!m.dm.pushDialog(this)){throw new Error("Failed to execute 'showModal' on dialog: There are too many open modal dialogs.")}if(i(this.dialog_.parentElement)){console.warn("A dialog is being shown inside a stacking context. This may cause it to be unusable. For more information, see this link: https://github.com/GoogleChrome/dialog-polyfill/#stacking-context")}this.setOpen(true);this.openAsModal_=true;if(m.needsCentering(this.dialog_)){m.reposition(this.dialog_);this.replacedStyleTop_=true}else{this.replacedStyleTop_=false}this.dialog_.parentNode.insertBefore(this.backdrop_,this.dialog_.nextSibling);this.focus_()},close:function(q){if(!this.dialog_.hasAttribute("open")){throw new Error("Failed to execute 'close' on dialog: The element does not have an 'open' attribute, and therefore cannot be closed.")}this.setOpen(false);if(q!==undefined){this.dialog_.returnValue=q}var p=new a("close",{bubbles:false,cancelable:false});this.dialog_.dispatchEvent(p)}};var m={};m.reposition=function(p){var r=document.body.scrollTop||document.documentElement.scrollTop;var q=r+(window.innerHeight-p.offsetHeight)/2;p.style.top=Math.max(r,q)+"px"};m.isInlinePositionSetByStylesheet=function(r){for(var s=0;s<document.styleSheets.length;++s){var x=document.styleSheets[s];var u=null;try{u=x.cssRules}catch(t){}if(!u){continue}for(var q=0;q<u.length;++q){var w=u[q];var y=null;try{y=document.querySelectorAll(w.selectorText)}catch(t){}if(!y||!k(y,r)){continue}var p=w.style.getPropertyValue("top");var v=w.style.getPropertyValue("bottom");if((p&&p!=="auto")||(v&&v!=="auto")){return true}}}return false};m.needsCentering=function(q){var p=window.getComputedStyle(q);if(p.position!=="absolute"){return false}if((q.style.top!=="auto"&&q.style.top!=="")||(q.style.bottom!=="auto"&&q.style.bottom!=="")){return false}return !m.isInlinePositionSetByStylesheet(q)};m.forceRegisterDialog=function(p){if(window.HTMLDialogElement||p.showModal){console.warn("This browser already supports <dialog>, the polyfill may not work correctly",p)}if(p.localName!=="dialog"){throw new Error("Failed to register dialog: The element is not a dialog.")}new n((p))};m.registerDialog=function(p){if(!p.showModal){m.forceRegisterDialog(p)}};m.DialogManager=function(){this.pendingDialogStack=[];var p=this.checkDOM_.bind(this);this.overlay=document.createElement("div");this.overlay.className="_dialog_overlay";this.overlay.addEventListener("click",function(q){this.forwardTab_=undefined;q.stopPropagation();p([])}.bind(this));this.handleKey_=this.handleKey_.bind(this);this.handleFocus_=this.handleFocus_.bind(this);this.zIndexLow_=100000;this.zIndexHigh_=100000+150;this.forwardTab_=undefined;if("MutationObserver" in window){this.mo_=new MutationObserver(function(q){var r=[];q.forEach(function(t){for(var s=0,u;u=t.removedNodes[s];++s){if(!(u instanceof Element)){continue}else{if(u.localName==="dialog"){r.push(u)}}r=r.concat(u.querySelectorAll("dialog"))}});r.length&&p(r)})}};m.DialogManager.prototype.blockDocument=function(){document.documentElement.addEventListener("focus",this.handleFocus_,true);document.addEventListener("keydown",this.handleKey_);this.mo_&&this.mo_.observe(document,{childList:true,subtree:true})};m.DialogManager.prototype.unblockDocument=function(){document.documentElement.removeEventListener("focus",this.handleFocus_,true);document.removeEventListener("keydown",this.handleKey_);this.mo_&&this.mo_.disconnect()};m.DialogManager.prototype.updateStacking=function(){var u=this.zIndexHigh_;for(var r=0,q;q=this.pendingDialogStack[r];++r){q.updateZIndex(--u,--u);if(r===0){this.overlay.style.zIndex=--u}}var s=this.pendingDialogStack[0];if(s){var t=s.dialog.parentNode||document.body;t.appendChild(this.overlay)}else{if(this.overlay.parentNode){this.overlay.parentNode.removeChild(this.overlay)}}};m.DialogManager.prototype.containedByTopDialog_=function(r){while(r=c(r)){for(var q=0,p;p=this.pendingDialogStack[q];++q){if(p.dialog===r){return q===0}}r=r.parentElement}return false};m.DialogManager.prototype.handleFocus_=function(s){if(this.containedByTopDialog_(s.target)){return}if(document.activeElement===document.documentElement){return}s.preventDefault();s.stopPropagation();o((s.target));if(this.forwardTab_===undefined){return}var r=this.pendingDialogStack[0];var q=r.dialog;var p=q.compareDocumentPosition(s.target);if(p&Node.DOCUMENT_POSITION_PRECEDING){if(this.forwardTab_){r.focus_()}else{if(s.target!==document.documentElement){document.documentElement.focus()}}}return false};m.DialogManager.prototype.handleKey_=function(r){this.forwardTab_=undefined;if(r.keyCode===27){r.preventDefault();r.stopPropagation();var q=new a("cancel",{bubbles:false,cancelable:true});var p=this.pendingDialogStack[0];if(p&&p.dialog.dispatchEvent(q)){p.dialog.close()}}else{if(r.keyCode===9){this.forwardTab_=!r.shiftKey}}};m.DialogManager.prototype.checkDOM_=function(p){var q=this.pendingDialogStack.slice();q.forEach(function(r){if(p.indexOf(r.dialog)!==-1){r.downgradeModal()}else{r.maybeHideModal()}})};m.DialogManager.prototype.pushDialog=function(p){var q=(this.zIndexHigh_-this.zIndexLow_)/2-1;if(this.pendingDialogStack.length>=q){return false}if(this.pendingDialogStack.unshift(p)===1){this.blockDocument()}this.updateStacking();return true};m.DialogManager.prototype.removeDialog=function(q){var p=this.pendingDialogStack.indexOf(q);if(p===-1){return}this.pendingDialogStack.splice(p,1);if(this.pendingDialogStack.length===0){this.unblockDocument()}this.updateStacking()};m.dm=new m.DialogManager();m.formSubmitter=null;m.useValue=null;if(window.HTMLDialogElement===undefined){var h=document.createElement("form");h.setAttribute("method","dialog");if(h.method!=="dialog"){var d=Object.getOwnPropertyDescriptor(HTMLFormElement.prototype,"method");if(d){var f=d.get;d.get=function(){if(j(this)){return"dialog"}return f.call(this)};var b=d.set;d.set=function(p){if(typeof p==="string"&&p.toLowerCase()==="dialog"){return this.setAttribute("method",p)}return b.call(this,p)};Object.defineProperty(HTMLFormElement.prototype,"method",d)}}document.addEventListener("click",function(r){m.formSubmitter=null;m.useValue=null;if(r.defaultPrevented){return}var s=(r.target);if(!s||!j(s.form)){return}var q=(s.type==="submit"&&["button","input"].indexOf(s.localName)>-1);if(!q){if(!(s.localName==="input"&&s.type==="image")){return}m.useValue=r.offsetX+","+r.offsetY}var p=c(s);if(!p){return}m.formSubmitter=s},false);var g=HTMLFormElement.prototype.submit;var e=function(){if(!j(this)){return g.call(this)}var p=c(this);p&&p.close()};HTMLFormElement.prototype.submit=e;document.addEventListener("submit",function(t){var r=(t.target);if(!j(r)){return}t.preventDefault();var p=c(r);if(!p){return}var q=m.formSubmitter;if(q&&q.form===r){p.close(m.useValue||q.value)}else{p.close()}m.formSubmitter=null},true)}return m}));